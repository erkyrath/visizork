# The Visible Zorker: an interactive fiction visualizer

- Designed by Andrew Plotkin <erkyrath@eblong.com>
- Web site: https://eblong.com/infocom/visi-zork1/

This is a web app that plays Zork, and simultaneously displays the code that runs Zork under the hood. It allows you to explore the implementation of Zork in the same way that you explore the game world. Call it an exercise in exploratory coding.

To try the Visible Zorker, [play it here][visizork]. For more about the intent and origins of the project, see my [blog post on the subject][post].

[post]: ###
[visizork]: https://eblong.com/infocom/visi-zork1/

## The contents of this repository

This repo contains quite a lot of material relating to Zork. Some of this is needed to run the game; some is used in the app UI; some was just useful to me in creating the app.

### The [`gamedat`](./gamedat) directory

This contains the Zork game file itself, plus a bonanza of information about how it is organized internally.

- zork1-r88-s840726.z3: Zork 1, release 88, serial 840726. (This is the playable Z-code file.) It's the version on the [Masterpieces of Infocom][masterpieces] CD and other modern collections. For other versions, see my [Obsessively Complete Infocom Catalog][ocicat].
- [`game-dump.txt`](./gamedat/game-dump.txt): A disassembly listing of the game file, generated by `txd` from the [ztools][] package. This shows the game functions in the form of Z-machine "assembly", plus the text of the game. But it does not have function names; everything is shown as raw addresses.
- [`obj-dump.txt`](./gamedat/obj-dump.txt): A listing of the objects in the game file, generated by `infodump -o` (also from [ztools][]). This shows the object tree layout, the printed names of objects, and their properties as raw numeric data.
- [`dict-dump.txt`](./gamedat/dict-dump.txt): A listing of the game dictionary, generated by `infodump -d`. Again, this contains the flags associated with each dict word in raw numeric form.
- [`zork1-i6.inf`](./gamedat/zork1-i6.inf): A translation of the disassembled game code into Inform 6 source, done by Allen Garvin. (Original file [here][z1i6].) We're not going to use this directly, but (if you know I6) it's very helpful in understanding the ZIL behavior.
- [`zork1.reform`](./gamedat/zork1.reform): A text file mapping game object numbers, global variables, and other numeric values to human-readable names. This is taken from the [analysis work][reform] done in 2007 by Allen Garvin, Ben Rudiak-Gould, and Ethan Dicks. (Original file [here][z1reform].)
- [`game-info`](./gamedat/game-info): A text file mapping game object numbers, global variables, and other numeric values to their ZIL source names. I created this in the course of building the Visible Zorker. It draws on *all* of the above data sources.
- [`commentary`](./gamedat/commentary): A text file containing my commentary and notes on the Zork source.

[ocicat]: https://eblong.com/infocom/
[ocicatz]: https://eblong.com/infocom/#zork1
[ztools]: https://ifarchive.org/indexes/if-archive/infocom/tools/ztools/
[reform]: https://ifarchive.org/indexes/if-archive/infocom/tools/reform/
[z1i6]: http://plover.net/~agarvin/zork1.txt
[z1reform]: https://unbox.ifarchive.org/2h08txtsli/conf/Zork1_88_840726.reform

Note that the human-readable symbol names in `zork1.reform` do *not* match the actual ZIL source code. That work was done before the ZIL source was available, so Allen and the others just invented names that made sense. (They tried to be consistent with Inform 6 conventions, which was useful at the time but not for our purposes here.)

The `game-info` file is my own work, which *does* associate everything with its original ZIL name.

Also note that I'm using a slight modification of the [ztools][] package, which displays output in ways that are a bit easier to parse. (We have a lot of scripts which imbibe the `game-dump.txt`, `obj-dump.txt`, `dict-dump.txt` files.) See [my fork here][ztools-esc].

[ztools-esc]: https://github.com/erkyrath/ztools/tree/c-out

### The [`gamesrc`](./gamesrc) directory

This contains the original ZIL source code for Zork 1.

A version of this source was [publicly released][histzork1] in April 2019 by Jason Scott. That wasn't zork1-r88-s840726, though; it was zork1-r119-s880429. I combed through a number of sources to locate every possible variation for the [Catalog][ocicatz]. Happily, the source for zork1-r88-s840726 -- the most commonly played version today -- *did* turn up.

[histzork1]: https://github.com/historicalsource/zork1

### The [`pyana`](./pyana) directory

Python scripts which parse the [`gamedat`](./gamedat) and [`gamesrc`](./gamesrc) files and convert them into JSON data in [`js`](./js) for the Visible Zorker to load.

Roughly, we need to parse all the ZIL source *and* the disassembled data, match up numeric addresses with source code names, and write it out in a format that the Javascript app can handle. We use a motley boatload of strategies to accomplish this. The [`game-info`](./gamedat/game-info) gives us a lot of the needed mappings. Others are based on source code order, memory address order, or whatever else works.

## Building the Visible Zorker

This repository comes with everything built. You can load [`index.html`](./index.html) and play right from the repo. (Not on Github, though. You'll have to check it out first.)

If you want to modify the project, you'll need to install some stuff.

As you see above, the Visible Zorker has a lot of moving parts. Some are written in Javascript; others are Typescript, which must be compiled to Javascript. The UI is built with the React display library.

To build everything from a standing start:

```
npm install
npm run build
```

This regenerates (almost) everything in the [`js`](./js) directory. Hopefully that will be identical, or almost identical, to what was already there.

